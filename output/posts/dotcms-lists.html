<!DOCTYPE html>
<html lang="en">
<head>
 <meta name="viewport" content="initial-scale=1" maximum-scale="1" />
          <title>Electric-Barnyard</title>
        <meta charset="utf-8" />
        <link href="http://bradrice.com/thoughts/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Electric-Barnyard Full Atom Feed" />
        <link href="http://bradrice.com/thoughts/feeds/atom.xml" type="application/atom+xml" rel="alternate" title="Electric-Barnyard Atom Feed" />
        <link href="http://bradrice.com/thoughts/feeds/velocity.atom.xml" type="application/atom+xml" rel="alternate" title="Electric-Barnyard Categories Atom Feed" />



    <meta name="tags" contents="dotcms" />
    <meta name="tags" contents="velocity" />
    <meta name="tags" contents="arrays" />

        <link href='http://fonts.googleapis.com/css?family=Pacifico|Oxygen:400,300,700' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" type="text/css" href="http://bradrice.com/thoughts/theme/css/style.css" />

</head>

<body id="index" class="home">

        
        <header id="banner" class="body">
        <div class="wrap">
        <div id="brand-holder">
                <img src="http://bradrice.com/thoughts/theme/images/electric-barnyard_400.jpg" alt="electric-barnyard" title="Electric barnyard" class="img-responsive" / >
        </div>
        <div id="brand-title">
                <h1><a href="http://bradrice.com/thoughts/thoughts">Electric-Barnyard</a></h1>
                <h4>Mucking about with code in rural Ohio</h4>
        </div>
        </div>
        <div class="wrap">
        <nav id="menu"><ul>
            <li><a href="/thoughts">Home</a></li>
              <li><a href="http://bradrice.com/thoughts/category/pelican">Pelican</a></li>
              <li><a href="http://bradrice.com/thoughts/category/python">Python</a></li>
              <li><a href="http://bradrice.com/thoughts/category/sass">SASS</a></li>
              <li class="active"><a href="http://bradrice.com/thoughts/category/velocity">Velocity</a></li>
        </ul></nav><!-- /#menu -->
        </div><!-- end wrap -->
        </header><!-- /#banner -->
        <div class="wrap">
        <div class="content">
<section id="content" class="body article-body">
  <header>
    <h2 class="entry-title">
      <a href="http://bradrice.com/thoughts/posts/dotcms-lists" rel="bookmark"
         title="Permalink to dotCMS - working with velocity and lists">dotCMS - working with velocity and&nbsp;lists</a></h2>
 
  </header>
  <footer class="post-info">
    <abbr class="published" title="2010-09-24T21:02:00">
      Fri 24 September 2010
    </abbr>
  </footer><!-- /.post-info -->
  <div class="entry-content">
    <p>Scripting is a common activity for the web developer. dotCMS has a built in templating language called Velocity and it isn&#8217;t really a full featured scripting language, but allows the web designer/developer a way to build dynamic webpages. Velocity is rather limited in scope if you look at the core macros it provides. However, standard viewtools expand it&#8217;s basic functionality and dotCMS has even expanded that basic set of tools with their own&nbsp;viewtools.</p>
<p>One of the most common things one needs to do when building dynamic web pages is loop through a set of query results and display those results. dotCMS has some built in macros for pulling content and what it returns is a list of hash items. So you can iterate through the results and print the fields as needed. However, there are times you need more control over your results. Fortunately dotCMS provides a viewtool called &#8220;contents&#8221; that has two very helpful&nbsp;methods.</p>
<p>The Java Programming language has a standard framework for working with collections. There are two core collections specified (collections and maps) See <a href="http://download.oracle.com/javase/tutorial/collections/interfaces/index.html">Java Collections</a> Interfaces. Of the collections core it is broken down. The one that dotcms exposes is List. dotcms also exposes Map through the contents&nbsp;viewtool.</p>
<p>The contents viewtool has two important methods for creating the list or map&nbsp;collection.</p>
<div class="highlight"><pre><span class="p">$</span><span class="nv">contents</span><span class="p">.</span><span class="nv">getEmptyList</span><span class="p">()</span><span class="x"> and </span><span class="p">$</span><span class="nv">contents</span><span class="p">.</span><span class="nv">getEmptyMap</span><span class="p">()</span><span class="x"></span>
</pre></div>


<p>You use these methods in a set statement. So if you want to create a new empty list use it like&nbsp;this:</p>
<div class="highlight"><pre><span class="cp">#</span><span class="nf">set</span><span class="p">($</span><span class="nv">contentList</span> <span class="o">=</span> <span class="p">$</span><span class="nv">contents</span><span class="p">.</span><span class="nv">getEmptyList</span><span class="p">())</span><span class="x"></span>
</pre></div>


<p>Now the unusual part that takes some getting used to for people coming from another script language is adding items to the list. You have to do it inside a set statement so it doesn&#8217;t print to your screen. So you create an unnecessary variable in the&nbsp;process.</p>
<div class="highlight"><pre><span class="cp">#</span><span class="nf">set</span><span class="p">($</span><span class="nv">_dummy</span> <span class="o">=</span> <span class="p">$</span><span class="nv">contentList</span><span class="p">.</span><span class="nv">add</span><span class="p">($</span><span class="nv">item</span><span class="p">))</span><span class="x"></span>
<span class="p">$</span><span class="nv">item</span><span class="x"> is some element you are adding to the list.</span>
</pre></div>


<p>If you have a list of [1, 2, 3] and you add 4 you will have a list of [1,2,3,4]. Using add is similar to push in&nbsp;Perl.</p>
<div class="highlight"><pre><span class="cp">#</span><span class="nf">set</span><span class="p">($</span><span class="nv">contentList</span> <span class="o">=</span> <span class="o">[</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="o">]</span><span class="p">)</span><span class="x"></span>
<span class="cp">#</span><span class="nf">set</span><span class="p">($</span><span class="nv">_dummy</span> <span class="o">=</span> <span class="p">$</span><span class="nv">contentList</span><span class="p">.</span><span class="nv">add</span><span class="p">(</span><span class="m">4</span><span class="p">))</span><span class="x"></span>
<span class="p">$</span><span class="nv">contentList</span><span class="x"> is now [1,2,3,4]</span>
</pre></div>


<p>You can add another list to a list, but the whole list is added as a single&nbsp;element.</p>
<div class="highlight"><pre><span class="cp">#</span><span class="nf">set</span><span class="p">($</span><span class="nv">_dummy</span> <span class="o">=</span> <span class="p">$</span><span class="nv">contentList</span><span class="p">.</span><span class="nv">add</span><span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">6</span><span class="p">))</span><span class="x"></span>
<span class="p">$</span><span class="nv">contentList</span><span class="x"> is now [1,2,3,[4,5,6]]</span>
</pre></div>


<p>Pulling an element out of the list is simple using the get&nbsp;method.</p>
<div class="highlight"><pre><span class="p">$</span><span class="nv">contentList</span><span class="p">.</span><span class="nv">get</span><span class="p">(</span><span class="m">2</span><span class="p">)</span><span class="x"></span>
<span class="x">returns 3</span>
<span class="p">$</span><span class="nv">contentList</span><span class="p">.</span><span class="nv">get</span><span class="p">(</span><span class="m">3</span><span class="p">)</span><span class="x"></span>
<span class="x">returns [4,5,6]</span>
<span class="p">$</span><span class="nv">contentList</span><span class="p">.</span><span class="nv">get</span><span class="p">(</span><span class="m">3</span><span class="p">).</span><span class="nv">get</span><span class="p">(</span><span class="m">1</span><span class="p">)</span><span class="x"></span>
<span class="x">returns 5</span>
</pre></div>


<p>Velocity lists are java lists, so you can use the java list methods on the&nbsp;list.</p>
<div class="highlight"><pre><span class="p">$</span><span class="nv">contentList</span><span class="p">.</span><span class="nv">contains</span><span class="p">(</span><span class="m">2</span><span class="p">)</span><span class="x"></span>
<span class="x">returns true</span>
<span class="p">$</span><span class="nv">contentList</span><span class="p">.</span><span class="nv">isEmpty</span><span class="p">()</span><span class="x"></span>
<span class="x">returns false</span>
</pre></div>


<p>Instead of adding the list as a single element you can add all the elements using the addAll()&nbsp;method.</p>
<div class="highlight"><pre><span class="p">$</span><span class="nv">contentList</span><span class="p">.</span><span class="nv">addAll</span><span class="p">(</span><span class="err">[‘banana’</span><span class="p">,</span> <span class="err">‘apple’</span><span class="p">,</span> <span class="err">‘peach’]</span><span class="p">)</span><span class="x"></span>
<span class="x">returns [1,2,3,[4,5,6],’banana’,’apple’,’peach’]</span>
</pre></div>


<p>To remove an&nbsp;element:</p>
<div class="highlight"><pre><span class="p">$</span><span class="nv">contentList</span><span class="p">.</span><span class="nv">remove</span><span class="p">(</span><span class="m">5</span><span class="p">)</span><span class="x"></span>
<span class="x">returns [1,2,3,[4,5,6],banana,apple]</span>
</pre></div>


<p>You may have a comma separated list you need to have as a list. Since that is a string you can use a string method to quickly create a&nbsp;list.</p>
<div class="highlight"><pre><span class="cp">#</span><span class="nf">set</span><span class="p">($</span><span class="nv">string</span> <span class="o">=</span> <span class="s2">&quot;lemon,orange,kiwi,pomegranate&quot;</span><span class="p">)</span><span class="x"></span>
<span class="cp">#</span><span class="nf">set</span><span class="p">($</span><span class="nv">listfromstring</span> <span class="o">=</span> <span class="p">$</span><span class="nv">string</span><span class="p">.</span><span class="nv">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">))</span><span class="x"></span>
</pre></div>


<p>There is a catch to this here. $listfromstring is actually an array rather than a list. That is what split returns. You can iterate through an array just like you can a list, but it you want to print it to the screen you will need to convert it to a list. dotCMS provides a method to do&nbsp;that.</p>
<div class="highlight"><pre><span class="cp">#</span><span class="nf">set</span><span class="p">($</span><span class="nv">dummy</span> <span class="o">=</span> <span class="p">$</span><span class="nv">UtilMethods</span><span class="p">.</span><span class="nv">arrayToArrayList</span><span class="p">($</span><span class="nv">listfromstring</span><span class="p">))</span><span class="x"></span>
</pre></div>


<p>Now $listfromstring is [lemon, orange, kiwi,&nbsp;pomegranate]</p>
<p>dotCMS provides additional methods to use. If you want to pull a random element out of the list you can&nbsp;use:</p>
<div class="highlight"><pre><span class="p">$</span><span class="nv">UtilMethods</span><span class="p">.</span><span class="nv">randomList</span><span class="p">($</span><span class="nv">listfromstring</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span><span class="x"></span>
</pre></div>


<p>returns [kiwi] - or one of the other 3 items
If you just want to shuffle up the list you can&nbsp;do:</p>
<div class="highlight"><pre><span class="p">$</span><span class="nv">UtilMethods</span><span class="p">.</span><span class="nv">randomList</span><span class="p">($</span><span class="nv">listfromstring</span><span class="p">,</span> <span class="p">$</span><span class="nv">listfromstring</span><span class="p">.</span><span class="nv">size</span><span class="p">())</span><span class="x"></span>
<span class="x">returns [lemon, kiwi, pomegranate, orange] - or some random iteration of that.</span>
</pre></div>


<p>Velocity provides a sort viewtool. In dotCMS it is called $sorter. To sort the&nbsp;list:</p>
<div class="highlight"><pre><span class="p">$</span><span class="nv">sorter</span><span class="p">.</span><span class="nv">sort</span><span class="p">($</span><span class="nv">listfromstring</span><span class="p">)</span><span class="x"></span>
<span class="x">returns [kiwi, lemon, orange, pomegranate]</span>
</pre></div>


<h3>Maps</h3>
<p>dotCMS works nearly the same way with maps. However instead of add you use the method put to populate the map. I&#8217;ll stop here and give some samples of map next time.
<a href="/thoughts/posts/dotcms-map-lists">Maplists</a></p>
  </div><!-- /.entry-content -->
</section>
        </div>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h4>Blogroll</h4>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="http://python.org/">Python.org</a></li>
                            <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
                            <li><a href="http://www.bradrice.com">Brad Rice</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <div class="icns">
                    <h4>Connect</h4>
                    <a href="http://www.bradrice.com/blog" target="_blank"><img src="/static/images/icons/BR_32.png"></a>
                    <a href="mailto:brad@bradrice.com"><img src="/static/images/icons/email_001.png" alt="email"></a>
                    <a href="https://www.facebook.com/brad.c.rice" target="_blank"><img src="/static/images/icons/facebook_001.png" alt="facebook"></a>
                    <a href="https://plus.google.com/u/0/110400900554477791544/posts" target="_blank"><img src="/static/images/icons/Google_Plus_001.png" alt="google+"></a>
                    <a href="http://www.linkedin.com/in/bradbucks/" target="_blank"><img src="/static/images/icons/Linkedin_001.png" alt="LinkedIn"></a>
                    <a href="http://twitter.com/brad_rice" target="_blank"><img src="/static/images/icons/Twitter_001.png" alt="twitter"></a>
                        <a href="http://bradrice.com/thoughts/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"><img src="/static/images/icons/RSS_001.png" alt="rss"></a>
                </div>
                </div><!-- /.social -->
        </section><!-- /#extras -->
        </div><!-- end wrap -->
        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->
        </footer><!-- /#contentinfo -->

</body>
</html>